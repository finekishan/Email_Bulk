<!DOCTYPE html>
<html>
<head>
    <title>Bulk Email Sender</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .nav { background: #007bff; color: white; padding: 15px 0; margin-bottom: 20px; }
        .nav-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .nav-links { display: flex; gap: 20px; }
        .nav-link { color: white; text-decoration: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; }
        .nav-link:hover, .nav-link.active { background: rgba(255,255,255,0.2); }
        .page { display: none; }
        .page.active { display: block; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 12px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; color: #007bff; }
        .table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .table th { background: #f8f9fa; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="nav">
        <div class="nav-content">
            <h1>üöÄ Bulk Email Sender</h1>
            <div class="nav-links">
                <span class="nav-link" onclick="showPage('dashboard')">üìä Dashboard</span>
                <span class="nav-link" onclick="showPage('send')">üìß Send Emails</span>
                <span class="nav-link" onclick="showPage('config')">‚öôÔ∏è SMTP Config</span>
                <span class="nav-link" onclick="showPage('reports')">üìà Reports</span>
                <span class="nav-link" onclick="logout()">Logout</span>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page active">
        <div class="container" style="max-width: 400px;">
            <h2>Login</h2>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit">Login</button>
            </form>
            <p><a href="#" onclick="showRegister()">Register here</a></p>
        </div>
    </div>

    <!-- Register Page -->
    <div id="register-page" class="page">
        <div class="container" style="max-width: 400px;">
            <h2>Register</h2>
            <form onsubmit="register(event)">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <button type="submit">Register</button>
            </form>
            <p><a href="#" onclick="showLogin()">Login here</a></p>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard" class="page">
        <div class="container">
            <h2>Dashboard</h2>
            <div class="stats" id="stats"></div>
            <button onclick="loadStats()">Refresh Stats</button>
        </div>
    </div>

    <!-- Send Emails Page -->
    <div id="send" class="page">
        <div class="container">
            <h2>Send Emails</h2>
            <form onsubmit="sendEmails(event)">
                <div class="form-group">
                    <label>Subject:</label>
                    <input type="text" id="emailSubject" required>
                </div>
                <div class="form-group">
                    <label>Message:</label>
                    <textarea id="emailMessage" rows="5" required></textarea>
                </div>
                <div class="form-group">
                    <label>Recipients (one per line):</label>
                    <textarea id="emailRecipients" rows="5" placeholder="email1@example.com&#10;email2@example.com" required></textarea>
                </div>
                <button type="submit">Send Emails</button>
            </form>
        </div>
    </div>

    <!-- SMTP Config Page -->
    <div id="config" class="page">
        <div class="container">
            <h2>SMTP Configuration</h2>
            <form onsubmit="saveConfig(event)">
                <div class="form-group">
                    <label>Config Name:</label>
                    <input type="text" id="configName" required>
                </div>
                <div class="form-group">
                    <label>SMTP Host:</label>
                    <input type="text" id="configHost" placeholder="smtp.gmail.com" required>
                </div>
                <div class="form-group">
                    <label>Port:</label>
                    <input type="number" id="configPort" value="587" required>
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="configUser" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="configPass" required>
                </div>
                <div class="form-group">
                    <label>From Email:</label>
                    <input type="email" id="configFromEmail" required>
                </div>
                <div class="form-group">
                    <label>From Name:</label>
                    <input type="text" id="configFromName">
                </div>
                <button type="submit">Save Configuration</button>
            </form>
            <div id="configList"></div>
        </div>
    </div>

    <!-- Reports Page -->
    <div id="reports" class="page">
        <div class="container">
            <h2>Email Reports</h2>
            <button onclick="loadReports()">Refresh Reports</button>
            <button onclick="clearLogs()">Clear Logs</button>
            <div id="reportsList"></div>
        </div>
    </div>

    <div id="message"></div>

    <script>
        const API_URL = 'http://localhost:3000';
        let currentUser = null;

        function showMessage(text, type = 'success') {
            const msg = document.getElementById('message');
            msg.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => msg.innerHTML = '', 5000);
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`[onclick="showPage('${pageId}')"]`).classList.add('active');
            
            if (pageId === 'dashboard') loadStats();
            if (pageId === 'config') loadConfigs();
            if (pageId === 'reports') loadReports();
        }

        function showLogin() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('login-page').classList.add('active');
        }

        function showRegister() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('register-page').classList.add('active');
        }

        async function register(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();
                
                if (data.success) {
                    showMessage('‚úÖ Registration successful! You can now login.', 'success');
                    showLogin();
                } else {
                    showMessage('‚ùå ' + data.message, 'error');
                }
            } catch (error) {
                showMessage('‚ùå Registration failed: ' + error.message, 'error');
            }
        }

        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    showMessage(`‚úÖ Welcome ${data.user.name}!`, 'success');
                    showPage('dashboard');
                } else {
                    showMessage('‚ùå ' + data.message, 'error');
                }
            } catch (error) {
                showMessage('‚ùå Login failed: ' + error.message, 'error');
            }
        }

        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/dashboard/stats`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('stats').innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${stats.total}</div>
                            <div>Total Emails</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.sent}</div>
                            <div>Sent</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.failed}</div>
                            <div>Failed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.successRate}%</div>
                            <div>Success Rate</div>
                        </div>
                    `;
                }
            } catch (error) {
                showMessage('‚ùå Failed to load stats', 'error');
            }
        }

        async function sendEmails(e) {
            e.preventDefault();
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;
            const recipients = document.getElementById('emailRecipients').value.split('\n').filter(email => email.trim());

            try {
                const response = await fetch(`${API_URL}/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ subject, message, recipients })
                });

                const data = await response.json();
                
                if (data.success) {
                    showMessage(`‚úÖ ${data.message}`, 'success');
                    document.querySelector('#send form').reset();
                } else {
                    showMessage('‚ùå ' + data.message, 'error');
                }
            } catch (error) {
                showMessage('‚ùå Failed to send emails', 'error');
            }
        }

        async function saveConfig(e) {
            e.preventDefault();
            const config = {
                name: document.getElementById('configName').value,
                host: document.getElementById('configHost').value,
                port: document.getElementById('configPort').value,
                user: document.getElementById('configUser').value,
                pass: document.getElementById('configPass').value,
                fromEmail: document.getElementById('configFromEmail').value,
                fromName: document.getElementById('configFromName').value
            };

            try {
                const response = await fetch(`${API_URL}/config/smtp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(config)
                });

                const data = await response.json();
                
                if (data.success) {
                    showMessage('‚úÖ SMTP configuration saved', 'success');
                    document.querySelector('#config form').reset();
                    loadConfigs();
                } else {
                    showMessage('‚ùå ' + data.message, 'error');
                }
            } catch (error) {
                showMessage('‚ùå Failed to save configuration', 'error');
            }
        }

        async function loadConfigs() {
            try {
                const response = await fetch(`${API_URL}/config/smtp`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    const configsHtml = data.configs.map(config => `
                        <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px;">
                            <h4>${config.name}</h4>
                            <p><strong>Host:</strong> ${config.host}:${config.port}</p>
                            <p><strong>User:</strong> ${config.user}</p>
                            <p><strong>From:</strong> ${config.fromEmail}</p>
                        </div>
                    `).join('');
                    
                    document.getElementById('configList').innerHTML = `
                        <h3>Saved Configurations</h3>
                        ${configsHtml || '<p>No configurations saved yet.</p>'}
                    `;
                }
            } catch (error) {
                console.error('Failed to load configs');
            }
        }

        async function loadReports() {
            try {
                const response = await fetch(`${API_URL}/report`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    const logsHtml = data.logs.map(log => `
                        <tr>
                            <td>${new Date(log.timestamp).toLocaleString()}</td>
                            <td>${log.email}</td>
                            <td>${log.subject}</td>
                            <td>${log.status}</td>
                        </tr>
                    `).join('');
                    
                    document.getElementById('reportsList').innerHTML = `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Email</th>
                                    <th>Subject</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${logsHtml || '<tr><td colspan="4">No logs found</td></tr>'}
                            </tbody>
                        </table>
                    `;
                }
            } catch (error) {
                showMessage('‚ùå Failed to load reports', 'error');
            }
        }

        async function clearLogs() {
            if (confirm('Are you sure you want to clear all logs?')) {
                try {
                    const response = await fetch(`${API_URL}/report/clear`, {
                        method: 'DELETE',
                        credentials: 'include'
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        showMessage('‚úÖ Logs cleared', 'success');
                        loadReports();
                    }
                } catch (error) {
                    showMessage('‚ùå Failed to clear logs', 'error');
                }
            }
        }

        function logout() {
            currentUser = null;
            showLogin();
            showMessage('‚úÖ Logged out successfully', 'success');
        }
    </script>
</body>
</html>